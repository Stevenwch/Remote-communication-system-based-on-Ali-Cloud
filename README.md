# Remote-communication-system-based-on-Ali-Cloud
- 应用技术：Linux、C/C++、libevent、Json、MySQL、Qt5。  
- 项目简介：基于阿里云服务器开发的通信系统，可实现异地聊天，完成了基本的交友功能，包括注册、登录、添加好友、创建群、私聊、群聊、上下线提醒和文件传输功能。  
- 主要工作：

1. 利用 Linux 下 VSCode 开发聊天服务器，libevent网络库 + 多线程模型实现高并发，阿里云Ubuntu运行服务器实现远程通信；
2. 利用 Qt5 设计客户端实现多窗口控制多进程任务；
3. 使用 Json 封装数据交互，作为私有的通信协议；
4. 使用 MySQL 数据库存储用户信息和群信息，当用户上线时，系统从数据库中读取必要信息存放在链表；
5. 设计文件服务器实现文件传输功能，用户可以同时聊天与传文件。  


1. 服务器设计方案

![演示文稿1_1669433445_01](https://user-images.githubusercontent.com/86617191/204433194-b5408d76-10e6-4400-a400-6a4101ae1c7c.png)

2. 服务器 - 数据库

![演示文稿1_1669433445_02](https://user-images.githubusercontent.com/86617191/204436682-99261035-43fa-428d-a5f1-d5762d7c6f9e.png)

3. 服务器 - 链表

![演示文稿1_1669433445_03](https://user-images.githubusercontent.com/86617191/204436726-0b8f4f59-8fc1-4f3c-829a-8e8baaed677e.png)    

4. 服务器 - 注册

    注册（服务器）

    收到消息				用户名（账户） + 密码

    解析cmd得到注册功能

    查找数据库，判断用户有没有注册

    1. 如果注册，回复客户端已经存在
    2. 没有注册，信息写入数据库（密码+好友），回复客户端成功

5. 服务器 - 登录及上线提醒

    解析收到的数据	cmd	login

    匹配数据库信息，验证用户名和密码是否正确：

    1. 不正确：回复客户端
    2. 正确：向在线用户链表中添加用户，回复好友列表同时向所有好友发送上线提醒

6. 服务器 - 添加好友

    收到数据，解析cmd，得到addr

    查找数据库，判断用户是否存在：

    1. 如果不存在，回复客户端，好友不存在
    2. 如果存在，判断是不是好友关系。如果是，回复已经是好友；如果不是，则修改数据库（双方）。回复客户端，添加成功；回复对方，多了一个好友。

7. 服务器 - 建群

    解析数据，得到 create_group

    查找数据库，判断群是否存在：

    1. 如果存在，回复创建失败
    2. 如果不存在，把群信息写入数据库，并且回复成功

8. 服务器 - 添加群

    1. 收到数据，解析得到 add_group
    2. 判断群是否存在，如果不存在，返回客户端 group_not_exist
    3. 判断用户是否在群里，如果在，返回客户端 user_in_group
    4. 修改数据库（用户表、群表），修改群链表
    5. 回复客户端 success

9. 服务器 - 私聊

    1. 收到数据，解析得到private_chat
    2. 判断对方是否在线，如果不在线，回复 offline
    3. 如果在线，转发消息，同时回复转发成功

10. 服务器 - 群聊

    1. 收到数据，解析得到 group_chat
    2. 遍历群链表，找到群用户链表
    3. 遍历群用户链表，找到对应的成员
    4. 遍历在线用户链表，找到对应的 bev
    5. 回复客户端，数据发送成功

11. 服务器 - 用户下线

    1. 收到数据，解析得到 offline
    2. 遍历链表（在线用户链表），删除节点
    3. 提醒所有好友，用户下线
    4. 线程退出（释放事件、释放集合、线程退出）

12. 服务器 - 文件传输

![演示文稿1_1669433445_04](https://user-images.githubusercontent.com/86617191/204436964-28585534-be3c-4fdc-9daa-de10b4e9422a.png)

